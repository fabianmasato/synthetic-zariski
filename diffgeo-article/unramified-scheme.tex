

\subsection{Unramified schemes}

\begin{lemma}\label{unramified-affine-characterisation}
Let $X$ be an affine scheme, the following are equivalent:
\begin{enumerate}[(i)]
\item $X$ is formally unramified.
\item Identity types in $X$ are decidable.
\item For all $x:X$, we have that $T_x(X)=0$.
\end{enumerate}
\end{lemma}

\begin{proof}
(i) implies (ii). By \Cref{closed-and-etale-decidable}.

(ii) implies (i). Because decidable implies formally Ã©tale.

(ii) implies (iii). Assume given $x:X$ with $t:T_x(X)$, then for all $\epsilon:\D(1)$ we have $\neg\neg(\epsilon = 0)$ so that we have $\neg\neg t(\epsilon) = t(0)$ which implies $t(\epsilon) = t(0)$ since equality is assumed decidable. Therefore $t = 0$ in $T_x(X)$.

(iii) implies (ii). Indeed given $\epsilon:R$ such that $\epsilon^2=0$, assume $x,y:X$ such that $\epsilon=0 \to x=y$. Then $x\in N_1(y)$ and by \Cref{duality-infinitesimal-tangent} and $T_y(X)=0$ we conclude $x=y$.
\end{proof}

\begin{corollary}\label{unramified-scheme-characterisation}
Let $X$ be a scheme, the following are equivalent:
\begin{enumerate}[(i)]
\item $X$ is formally unramified.
\item Identity types in $X$ are open.
\item For all $x:X$, we have that $T_x(X)=0$.
\end{enumerate}
\end{corollary}

\begin{proof}
Assume $(U_i)_{i:I}$ a finite cover of $X$ by affine schemes. By \Cref{etale-zariski-local} we have that $X$ is formally unramified if and only $U_i$ is formally unramified for all $i:I$.

(ii) implies (i). By \Cref{not-not-stable-prop-etale}.

(i) implies (iii). Indeed for all $x:X$ there exists $i:I$ such that $x\in U_i$ and then $T_x(X) = T_x(U_i)$ and $T_x(U_i) = 0$ by \Cref{unramified-affine-characterisation}.

(iii) implies (ii). Assume $x,y:X$, then:
\[x=_Xy \leftrightarrow \Sigma_{y\in U_i} x=_{U_i} y\]
By \Cref{unramified-affine-characterisation} we have that identity types in $U_i$ is decidable, so $x=_Xy$ is open.
\end{proof}

\subsection{Unramified morphisms between schemes}

Now we generalise this to maps between schemes.

\begin{proposition}\label{unramified-map-characterisation}
A map between schemes is unramified if and only if its differentials are injective. 
\end{proposition}

\begin{proof}
The map $df_x$ is injective if and only if its kernel is $0$. By \Cref{kernel-is-tangent-of-fibers}, this means that $df_x$ is injective for all $x:X$ if and only if:
\[
\prod_{x:X}T_{(x,\refl_{f(x)})}(\mathrm{fib}_f(f(x)))=0
\]
On the other hand having fibers with trivial tangent space is equivalent to:
\[
\prod_{y:Y}\prod_{x:X}\prod_{p:f(x)=y} T_{(x,p)}(\mathrm{fib}_f(y)) = 0
\]
Both are equivalent by path elimination on $p$.
\end{proof}


\subsection{Unramified schemes are locally standard}

\begin{definition}
A scheme is called standard unramified if it is of the form:
\[\Spec(R[X_1,\cdots,X_n]/P_1,\cdots,P_k)\]
with $k\geq n$ such that the determinant of:
\[\left( \frac{\partial P_i}{\partial X_j}\right)_{1\leq i,j\leq n}\]
is invertible.
\end{definition}

\begin{proposition}
A scheme is unramified if and only if it has a cover by standard unramified schemes.
\end{proposition}

\begin{proof}
By \Cref{etale-zariski-local} we have the converse. If $X$ is an unramified scheme, up to taking an affine cover we can assume:
\[X = \Spec(R[X_1,\cdots,X_n]/P_1,\cdots,P_k)\]
Assume $x:X$, by \Cref{tangent-finite-copresented} we have an exact sequence: 
\begin{center}
\begin{tikzcd}
0\ar[r] & T_x(X)\ar[r] & R^n\ar[r] & R^k
\end{tikzcd}
\end{center}
So by \Cref{unramified-affine-characterisation} we know that $\mathrm{Jac}(P_1,\cdots,P_k)_{x}$ is the matrix of an injective map, therefore $k\geq n$ and one of its $n$-minor is invertible. Now we can conclude by covering according to which $n$-minor is invertible and reordering variables.
\end{proof}


