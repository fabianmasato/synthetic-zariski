In this section we compute $H^1(S,\Z) = 0$ for $S$ Stone, and show that $H^1(X,\Z)$ for $X$ compact Hausdorff can be computed using \v{C}ech cohomology. We then apply this to compute $H^1(\mathbb{I},\Z)=0$. We work on the first cohomology group with coefficient in $\Z$ as it is sufficient for the proof of Brouwer's fixed-point theorem, but the results could be extended to $H^n(X,A)$ for $A$ any family of countably presented abelian groups indexed by $X$.

\subsection{Needed results}

\rednote{Should probably be moved elsewhere}

\begin{lemma}\label{finite-approximation-surjection-stone}
Given $S:\Stone$ and $T:S\to\Stone$ such that $\prod_{x:S}\propTrunc{T(x)}$, there exists a sequence of finite types $(S_k)_{k:\N}$
%\begin{equation}
%\begin{tikzcd}
%S_0 & S_1 \ar[l,"p_0"]& S_2\ar[l,"p_1"] & \cdots\ar[l]\\
%\end{tikzcd}
%\end{equation}
such that: 
\[\mathrm{lim}_kS_k = S\] 
and for each $k:\N$ we have a family of finite types $T_k(x)$ for $x:S_k$ such that $\prod_{x:S_k}\propTrunc{T_k(x)}$ with maps:
\[T_{k+1}(x) \to T_k(p_k(x))\]
such that:
\[\mathrm{lim}_k\left(\sum_{x:S_k}T_k(x)\right) = \sum_{x:S}T(x)\]
\end{lemma}

\begin{proof}
\rednote{ \@ Hugo This follows from \Cref{ProFiniteMapsFactorization} and \Cref{stone-sigma-closed} 
  and considering the surjection $(\Sigma_{x:S} T(x)) \to S$, but we discussed whether it might be easier to 
  refactor the proof where you use the above or make a remark after \Cref{stone-sigma-closed}}
\end{proof}

\begin{lemma}\label{scott-continuity}
Consider $(S_k)_{k:\N}$ a sequence of finite types, then the canonical map:
\[\mathrm{colim}_k(\Z^{S_k}) \to \Z^{\mathrm{lim}_kS_k}\] 
is an equivalence
\end{lemma}

\begin{proof}
TODO
\end{proof}


\subsection{\v{C}ech cohomology}

\begin{definition}
Given $S:\Type$ with $T:S\to \Type$ and $A:S\to\mathrm{Ab}$, we define $\check{C}(S,T,A)$ as the chain complex:
\begin{equation}
\begin{tikzcd}
     \prod_{x:S}A_x^{T_x} \ar[r,"d_0"] & \prod_{x:S}A_x^{T_x^2}\ar[r,"d_1"] &  \prod_{x:S}A_x^{T_x^3}\\
\end{tikzcd}
\end{equation}
with the usual boundary maps:
\[d_0(\alpha)_x(u,v) = \alpha_x(v)-\alpha_x(u)\]
\[d_1(\beta)_x(u,v,w) = \beta_x(v,w) - \beta_x(u,w) + \beta_x(u,w)\]
\end{definition}

\begin{definition}
Given $S:\Type$ with $T:S\to \Type$ and $A:S\to\mathrm{Ab}$, we define its \v{C}ech cohomology groups by:
\[\check{H}^0(S,T,A) = \mathrm{ker}(d_0)\]
\[\check{H}^1(S,T,A) = \mathrm{ker}(d_1)/\mathrm{im}(d_0)\]
\end{definition}

This means that $\check{H}^1(S,T,A) = 0$ if and only if $\check{C}(S,T,A)$ is exact. Now we give three very general lemmas about \v{C}ech complexes.

\begin{lemma}\label{section-exact-cech-complex}
Given $S:\Type$ with $T:S\to \Type$ and $A:S\to\mathrm{Ab}$ with $t:\prod_{x:S}T_x$, then we have that $\check{C}(S,T,A)$ is exact.
\end{lemma}

\begin{proof}
Assume given a cocycle, i.e. $\beta:\prod_{x:S}A_x^{T_x^2}$ such that for all $x:S$ and $u,v,w:T_x$ we have that:
\[\beta_x(u,v)+\beta_x(v,w) = \beta_x(u,w)\]
Define:
\[\alpha:\prod_{x:S}A_x^{T_x}\]
\[\alpha_x(u) = \beta_x(t_x,u)\]
Then for all $x:S$ and $u,v:T_x$ we have that:
\[\alpha_x(v)-\alpha_x(u) = \beta_x(t_x,v) - \beta_x(t_x,u) = \beta_x(u,t_x)+\beta_x(t_x,v) = \beta_x(u,v)\]
so that $\beta$ is a coboundary.
\end{proof}

\begin{lemma}\label{canonical-exact-cech-complex}
Given $S:\Type$ with $T:S\to \Type$ and $A:S\to\mathrm{Ab}$, we have that $\check{C}(S,T,\lambda x.A_x^{T_x})$ is exact.
\end{lemma}

\begin{proof}
Assume given a cocycle, i.e. $\beta:\prod_{x:S}A_x^{T_x^3}$ such that for all $x:S$ and $u,v,w,t:T_x$ we have that:
\[\beta_x(u,v,t)+\beta_x(v,w,t) = \beta_x(u,w,t)\]
Define:
\[\alpha:\prod_{x:S}A_x^{T_x^2}\]
\[\alpha_x(u,t) = \beta_x(t,u,t)\]
Then for all $x:S$ and $u,v,t:T_x$ we have that:
\[\alpha_x(v,t)-\alpha_x(u,t) = \beta_x(t,v,t) - \beta_x(t,u,t) = \beta_x(u,t,t)+\beta_x(t,v,t) = \beta_x(u,v,t)\]
so that $\beta$ is a coboundary.
\end{proof}

\begin{lemma}\label{exact-cech-complex-vanishing-cohomology}
Given $S:\Type$ with $T:S\to \Type$ and $A:S\to\mathrm{Ab}$, assume that $\check{C}(S,T,A)$ is exact. Then given:
\[\alpha:\prod_{x:S}BA_x\]
with
\[\beta: \prod_{x:S} (\alpha(x) = *)^{T_x}\]
we can conclude that:
\[\alpha = *\]
\end{lemma}

\begin{proof}
We define:
\[g : \prod_{x:S} A_x^{T_x^2}\]
\[g_x(u,v) = \beta_x(u)^{-1}\cdot\beta_x(v)\] 
It is a cocycle in the \v{C}ech complex, so that by exactness there is $f:\prod_{x:S}A_x^{T_x}$ such that for all $x:S$ and $u,v:T_x$ we have that:
\[g_x(u,v)=f_x(v)\cdot f_x(u)^{-1}\]
Then we define:
\[\beta' : \prod_{x:S}(\alpha(x)=*)^{T_x}\]
\[\beta'_x(u) = \beta_x(u)\cdot f_x(u)\]
so that for all $x:S$ and $u,v:T(x)$ we have that:
\[\beta'_x(v)^{-1}\cdot\beta'_x(u) = f_x(v)^{-1}\cdot\beta_x(v)^{-1}\cdot\beta_x(u)\cdot f_x(u) = \mathrm{refl}\]
so that:
\[\beta'_x(u)=\beta'_x(v)\]
and this means that $\beta'$ factors through $S$, giving a proof of $\alpha = *$.
\end{proof}


\subsection{Cohomology of Stone spaces}

\begin{lemma}\label{cech-complex-vanishing-stone}
Given $S:\Stone$ with $T:S\to\Stone$, if $\prod_{x:S}\propTrunc{T_x}$ then we have that $\check{C}(S,T,\Z)$ is exact.
\end{lemma}

\begin{proof}
We apply \cref{finite-approximation-surjection-stone} to get $S_k$ and $T_k$ finite. Then by \cref{scott-continuity} we have that:
\[\mathrm{colim}_k \check{C}(S_k,T_k,\Z) = \check{C}(S,T,\Z)\]
and each of the $\check{C}(S_k,T_k,\Z)$ is exact by \cref{section-exact-cech-complex} so we can conclude since a sequential colimit of exact sequence is exact.
\end{proof}

\begin{lemma}\label{eilenberg-stone-vanish}
Given $S:\Stone$, we have that $H^1(S,\Z) = 0$. 
\end{lemma}

\begin{proof}
Assume given a map $\alpha:S\to B\Z$. We use local choice to get $T:S\to\Stone$ such that $\prod_{x:S}\propTrunc{T_x}$ and:
\[\beta:\prod_{x:S}(\alpha(x)=*)^{T_x}\]
and then apply \cref{cech-complex-vanishing-stone} and \cref{exact-cech-complex-vanishing-cohomology} to conclude.
\end{proof}

\begin{corollary}\label{stone-commute-delooping}
For any $S:\Stone$ the canonical map:
\[B(\Z^S) \to B\Z^S\]
is an equivalence.
\end{corollary}


\subsection{\v{C}ech cohomology of compact Hausdorff spaces}

\begin{definition}
A \v{C}ech cover consists of $X:\CHaus$ and $S:X\to\Stone$ such that $\prod_{x:X}\propTrunc{S_x}$ and $\sum_{x:X}S_x:\Stone$.
\end{definition}

By definition any compact Hausdorff type has a \v{C}ech cover.

\begin{lemma}\label{cech-eilenberg-0-agree}
Given a \v{C}ech cover $(X,S)$, we have that:
\[H^0(X,\Z) = \check{H}^0(X,S,\Z)\]
\end{lemma}

\begin{proof}
By definition an element in $\check{H}^0(X,S,\Z)$ is a map:
\[f:\prod_{x:X}\Z^{S_x}\]
such that for all $u,v:S_x$ we have $f(u)=f(v)$, which is equivalent to a map:
\[\prod_{x:X}\Z^{\propTrunc{S_x}}\]
since $\Z$ is set, and since the $S_x$ are merely inhabited this is the same as $\Z^X$.
\end{proof}

\begin{lemma}\label{eilenberg-exact}
Given a \v{C}ech cover $(X,S)$ we have an exact sequence:
\[H^0(X,\lambda x.\Z^{S_x}) \to H^0(X,\lambda x.\Z^{S_x}/\Z) \to H^1(X,\Z)\to 0\]
\end{lemma}

\begin{proof}
We use the long exact cohomology sequence associated to:
\[0 \to \Z \to \Z^{S_x} \to \Z^{S_x}/\Z\to 0\]
so that we just need $H^1(X,\lambda x.\Z^{S_x}) = 0$ to conclude. But by \cref{stone-commute-delooping} we have that:
\[H^1(X,\lambda x.\Z^{S_x}) = H^1\left(\sum_{x:X}S_x,\Z\right)\]
which vanishes by \cref{eilenberg-stone-vanish}.
\end{proof}

\begin{lemma}\label{cech-exact}
Given a \v{C}ech cover $(X,S)$ we have an exact sequence:
\[\check{H}^0(X,\lambda x.\Z^{S_x}) \to \check{H}^0(X,\lambda x.\Z^{S_x}/\Z) \to \check{H}^1(X,\Z)\to 0\]
\end{lemma}

\begin{proof}
By \cref{eilenberg-stone-vanish} we have an exact sequence of complexes:
\[0 \to \check{C}(X,S,\Z) \to \check{C}(X,S,\lambda x.\Z^{S_x}) \to \check{C}(X,S,\lambda x.\Z^{S_x}/\Z)\]
But since $\check{H}^1(X,\lambda x.\Z^{S_x}) = 0$ by \cref{canonical-exact-cech-complex}, we conclude using the associated long exact sequence.
\end{proof}

\begin{theorem}\label{cech-eilenberg-1-agree}
Given a \v{C}ech cover $(X,S)$, we have that:
\[H^1(X,\Z) = \check{H}^1(X,S,\Z)\]
\end{theorem}

\begin{proof}
We apply \cref{cech-eilenberg-0-agree}, \cref{eilenberg-exact} and \cref{cech-exact}.
\end{proof}

In particular this means that the \v{C}ech cohomology $\check{H}^1(X,S,\Z)$ do not depend on $S$.


\subsection{Cohomology of the interval}

Recall that we denote $C_n=2^n$ with a binary relation $\sim_n$ on $C_n$ such that for all $x,y:2^\N$ we have that:
\[\left(\forall(n:\N).\ x|_n\sim_n y|_n\right) \leftrightarrow x=_\mathbb{I}y\]

\begin{lemma}\label{description-Cn-simn}
We have that $(C_n,\sim_n)$ is equivalent to $(\mathrm{Fin}(2^n),\lambda x,y.\ |x-y|\leq 1)$.
\end{lemma}

\begin{proof}
By \cref{alternativeSimByCauchyDistance}.
\end{proof}

We write:
\[C_n^{\sim2} = \sum_{x,y:C_n}x\sim_n y\]
\[C_n^{\sim3}  =  \sum_{x,y,z:C_n}x\sim_n y \land y\sim_n z\land x\sim_n z\]

\begin{lemma}\label{Cn-exact-sequence}
For any $n:\N$ we have an exact sequence:
\[0\to \Z\to \Z^{C_n} \to \Z^{C_n^{\sim2}} \to \Z^{C_n^{\sim3}}\]
with the obvious boundary maps.
\end{lemma}

\begin{proof}
It is clear that the map $\Z\to \Z^{C_n}$ is injective as $C_n$ is inhabited, so the sequence is exact at $\Z$.

Assume a cocycle $\alpha:\Z^{C_n}$, meaning that for all $u,v:C_n$, if $u\sim_nv$ then $\alpha(u)=\alpha(v)$. Then by \cref{description-Cn-simn} we see that $\alpha$ is constant, so the sequence is exact at $\Z^{C_n}$.

Assume a cocycle $\beta:\Z^{C_n^{\sim2}}$, meaning that for all $u,v,w:C_n$ such that $u\sim_nv$, $v\sim_nw$ and $u\sim_nw$ we have that:
\[\beta(u,v)+\beta(v,w) = \beta(u,w)\]
which is equivalent to asking $\beta(u,u)=0$ and $\beta(u,v) = -\beta(v,u)$.

Using \cref{description-Cn-simn} we can define: 
\[\alpha(n) = \beta(0,1)+\cdots+\beta(n-1,n)\]
Then for all $(m,n)$ such that $|m-n|\leq 1$ we have that:
\begin{itemize} 
\item If $m=n$ and then $\beta(m,m) = 0 = \alpha(m)-\alpha(m)$.
\item If $m+1=n$ then $\beta(m,m+1) = \alpha(m+1)-\alpha(m)$.
\item If $m=n+1$ then $\beta(n+1,n) = - \beta(n,n+1) = -\alpha(n+1)+\alpha(n)$.
\end{itemize}
So $\beta$ is indeed a coboundary and the sequence is exact at $\Z^{C_n^{\sim2}}$.
\end{proof}

\begin{proposition}\label{cohomology-I}
We have that:
\[H^0(\mathbb{I},\Z) = \Z\]
\[H^1(\mathbb{I},\Z) = 0\]
\end{proposition}

\begin{proof}
Consider the canonical surjective map $p:2^\N\to\mathbb{I}$ and the associated \v{C}ech cover of $\mathbb{I}$ by: 
\[T_x = \sum_{y:2^\N} x=_\mathbb{I} p(y)\]
Then for $l=2,3$ we have that:
\[\mathrm{lim}_nC_n^{\sim l} = \sum_{x:\mathbb{I}} T_x^l\]

By \cref{Cn-exact-sequence} and stability of exactness under sequential colimit, we know that:
\[ 0\to \Z\to \mathrm{colim}_n \left(\Z^{C_n}\right) \to \mathrm{colim}_n \left(\Z^{C_n^{\sim2}}\right)\to \mathrm{colim}_n \left(\Z^{C_n^{\sim3}}\right)\]
is exact, but by \cref{scott-continuity} this sequence is equivalent to:
\[ 0\to \Z\to \prod_{x:\mathbb{I}}\Z^{T_x} \to  \prod_{x:\mathbb{I}}\Z^{T_x^2} \to  \prod_{x:\mathbb{I}}\Z^{T_x^3}\]
So it being exact implies that:
\[\check{H}^0(\mathbb{I},T,\Z) = \Z\]
\[\check{H}^1(\mathbb{I},T,\Z) = 0\]
We conclude by \cref{cech-eilenberg-0-agree} and \cref{cech-eilenberg-1-agree}.
\end{proof}

\begin{remark}
We could carry a similar computation for $\mathbb{S}^1$, by approximating it with $2^n$ with $0^n\sim_n1^n$ added. We would find $H^1(\mathbb{S}^1,\Z)=\Z$.
\end{remark}


\subsection{There is no retraction to the boundary inclusion in the disk}

\rednote{This section is fun and interesting, but it would be shorter to just compute $H^1(\mathbb{S}^1,\Z)=\Z$ in the previous section, and it would require less requisite on modalities in HoTT.}

Here we consider the modality defined by localising at $\mathbb{I}$ \cite{modalities}, denoted by $L_\mathbb{I}$. We say $X$ is $\mathbb{I}$-local if $L_\mathbb{I}(X) = X$ and that it is $\mathbb{I}$-contractible if $L_\mathbb{I}(X)=1$.

\begin{lemma}\label{BZ-I-local}
We have that $B\Z$ is $\mathbb{I}$-local.
\end{lemma}

\begin{proof}
By \cref{cohomology-I}, from $H^0(\mathbb{I},\Z)=\Z$ we get that the map $\Z\to \Z^\mathbb{I}$ is an equivalence, so $\Z$ is $\mathbb{I}$-local and therefore any identity type in $B\Z$ is $\mathbb{I}$-local. So there is at most one factorisation of any map $\mathbb{I}\to B\Z$ through $1$. From $H^1(\mathbb{I},\Z)=0$ we get that there merely exists such a factorisation.
\end{proof}

\begin{lemma}\label{continuously-path-connected-contractible}
Assume $X$ a pointed type such that for all $x:X$ we have $f:\mathbb{I}\to X$ such that $f(0)=*$ and $f(1)=x$. Then $X$ is $\mathbb{I}$-contractible.
\end{lemma}

\begin{proof}
%First we prove that the map:
%\[\eta_X:X\to L_\mathbb{I}(X)\] 
%is surjective. Indeed its fiber are $\mathbb{I}$-contractible, but for any type $F$ we have a map:
%\[L_\mathbb{I}(F) \to L_\mathbb{F}(\propTrunc{F}) = \propTrunc{F}\] 
For all $x:X$ we get a map:
\[f:\mathbb{I}\to X\to L_\mathbb{I}(X)\]
such that $f(0) = [*]$ and $f(1)=[x]$. Since $L_\mathbb{I}(X)$ is $\mathbb{I}$-local this means that:
\[\prod_{x:X}[*]=[x]\]
We conclude:
\[\prod_{x:L_\mathbb{I}(X)}[*]=x\]
by applying the elimination principle for the modality.
\end{proof}

\begin{corollary}\label{R-I-contractible}
We have that $\R$ and $\mathbb{D}^2\colonequiv\{(x,y):\mathbb R\vert x^2+y^2\leq 1\}$ are $\mathbb{I}$-contractible.
\end{corollary}

\begin{proposition}\label{shape-S1-is-BZ}
We have that $L_\mathbb{I}(\R/\Z) = B\Z$.
\end{proposition}

\begin{proof}
As for any group quotient, the fibers of the map:
\[\R\to\R/\Z\]
are $\Z$-torsor, se we have an induced pullback square:
\begin{center}
\begin{tikzcd}
\R\ar[r]\ar[d] & 1\ar[d] \\
\R/\Z\ar[r] & B\Z\\
\end{tikzcd}
\end{center}
Now we check that the bottom map is an $\mathbb{I}$-localisation. Since $B\Z$ is $\mathbb{I}$-local by \cref{BZ-I-local} it is enough to check that its fibers are $\mathbb{I}$-contractible. Since $B\Z$ is connected it is enough to check $\R$ is $\mathbb{I}$-contractible, but this is \cref{R-I-contractible}.
\end{proof}

\begin{remark}
By \cref{BZ-I-local}, for any $X$ we have that $H^1(X,\Z) = H^1(L_{\mathbb{I}}(X),\Z)$, so that by \cref{shape-S1-is-BZ} we have that $H^1(\R/\Z,\Z) = H^1(B\Z,\Z) = \Z$.
\end{remark}

We omit the proof that $\mathbb{S}^1\colonequiv\{(x,y):\R\vert x^2+y^2=1\}$ is equivalent to $\R/\Z$.
The equivalence can be constructed using trigonometric functions, which exists by \cite{Bishop}[Prop 4.12].

\begin{proposition}
\label{no-retraction}
The map $\mathbb{S}^1\to \mathbb{D}^2$ has no retraction.
\end{proposition}

\begin{proof}
Otherwise by \cref{R-I-contractible} and \cref{shape-S1-is-BZ} we would get a retraction of $B\Z\to 1$, so $B\Z$ would be contractible.
\end{proof}

\begin{theorem}[Intermediate value theorem]
  \label{ivt}
  For any $f: I\to I$ and $y:I$ such that $f(0)\leq y$ and $y\leq f(1)$,
  there exists $x:I$ such that $f(x)=y$.
\end{theorem}

\begin{proof}
  By \Cref{InhabitedClosedSubSpaceClosedCHaus}, the proposition $\exists x:I.f(x)=y$ is closed and therefore $\neg\neg$-stable, so we can proceed with a proof by contradiction.
  If there is no such $x:I$, we have $f(x)\neq y$ for all $x:I$.
  Then, by \Cref{inequality-lesser-greater-than} the following two sets cover $I$:
  \[
    U_0\colonequiv \{x:I\mid f(x)<y\} \quad\quad
    U_1\colonequiv \{x:I\mid y<f(x)\}
    \]
  Since $U_0$ and $U_1$ are disjoint, we have $I=U_0+U_1$ which allows us to define a non-constant function $I\to 2$, which contradicts \Cref{cohomology-I}.
  \rednote{It would be nicer to refer to the statement that $I$ is connected.}
\end{proof}

\begin{theorem}[Brouwer's fixed-point theorem]
  For all $f:\mathbb{D}^2\to \mathbb{D}^2$ there exists $x:\mathbb{D}^2$ such that $f(x)=x$.
\end{theorem}

\begin{proof}
  As above, by \Cref{InhabitedClosedSubSpaceClosedCHaus}, we can proceed with a proof by contradiction,
  so we assume $f(x)\neq x$ for all $x:\mathbb{D}^2$.
  For any $x:\mathbb{D}^2$ we set $d_x\colonequiv x-f(x)$, so we have that one of the coordinates of $d_x$ is invertible.
  Let $H(t)\colonequiv f(x) + t\cdot d_x $ be the line through $x$ and $f(x)$.
  By \Cref{ivt}, there are intersections of $H$ and $\partial\mathbb{D}^2=\mathbb{S}^1$, both for $t\leq 0$ and for $t> 0$, which have to be distinct.
  Since these correspond to distinct solutions of a monic quadratic equation, we know there can be only two.
  We denote the intersection for $t> 0$ with $r(x)$, which has the property that it preserves $\mathbb{S}^1$.
  Then $r$ is a retraction from $\mathbb{D}^2$ onto its boundary $\mathbb{S}^1$, which is a contradiction by \Cref{no-retraction}.
\end{proof}
