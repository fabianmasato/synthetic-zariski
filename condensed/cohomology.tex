In this section we compute $H^1(S,\Z) = 0$ for $S$ Stone, and show that $H^1(X,\Z)$ for $X$ compact Hausdorff can be computed using \v{C}ech cohomology. We then apply this to compute $H^1(\I,\Z)=0$. 

\begin{remark}
We only work with the first cohomology group with coefficients in $\Z$ as it is sufficient for the proof of Brouwer's fixed-point theorem, but the results could be extended to $H^n(X,A)$ for $A$ any family of countably presented abelian groups indexed by $X$.
\end{remark}

\begin{remark}
We write $Ab$ for the type of Abelian groups and if $G:Ab$ we write $\B G$ for the delooping of $G$ \cite{hott,davidw23}. This means that $H^1(X,G)$ is the set truncation of $X \to \B G$. 
\end{remark}

\subsection{\v{C}ech cohomology}

\begin{definition}
Given a type $S$, types $T_x$ for $x:S$ and $A:S\to\mathrm{Ab}$, we define $\check{C}(S,T,A)$ as the chain complex:
\[
\begin{tikzcd}
     \prod_{x:S}A_x^{T_x} \ar[r,"d_0"] & \prod_{x:S}A_x^{T_x^2}\ar[r,"d_1"] &  \prod_{x:S}A_x^{T_x^3}
\end{tikzcd}
\]
with the usual boundary maps:
\begin{align*}
d_0(\alpha)_x(u,v) =&\ \alpha_x(v)-\alpha_x(u)\\
d_1(\beta)_x(u,v,w) =&\ \beta_x(v,w) - \beta_x(u,w) + \beta_x(u,w)
\end{align*}
\end{definition}

\begin{definition}
Given a type $S$, types $T_x$ for $x:S$ and $A:S\to\mathrm{Ab}$, we define its \v{C}ech cohomology groups by:
\[
  \check{H}^0(S,T,A) = \mathrm{ker}(d_0)\quad \quad \quad \check{H}^1(S,T,A) = \mathrm{ker}(d_1)/\mathrm{im}(d_0)
\]
We call elements of $\mathrm{ker}(d_1)$ cocycles and elements of $\mathrm{im}(d_0)$ coboundaries.
\end{definition}

This means that $\check{H}^1(S,T,A) = 0$ if and only if $\check{C}(S,T,A)$ is exact. Now we give three general lemmas about \v{C}ech complexes.

\begin{lemma}\label{section-exact-cech-complex}
Assume a type $S$, types $T_x$ for $x:S$ and $A:S\to\mathrm{Ab}$ with $t:\prod_{x:S}T_x$. Then $\check{C}(S,T,A)$ is exact.
\end{lemma}

\begin{proof}
Assume given a cocycle, i.e. $\beta:\prod_{x:S}A_x^{T_x^2}$ such that for all $x:S$ and $u,v,w:T_x$ we have that $\beta_x(u,v)+\beta_x(v,w) = \beta_x(u,w)$. We define $\alpha:\prod_{x:S}A_x^{T_x}$ by $\alpha_x(u) = \beta_x(t_x,u)$. Then for all $x:S$ and $u,v:T_x$ we have that $d_0(\alpha)_x(u,v) =  \beta_x(t_x,v) - \beta_x(t_x,u) = \beta_x(u,v)$ so that $\beta$ is a coboundary.
\end{proof}

\begin{lemma}\label{canonical-exact-cech-complex}
Given a type $S$, types $T_x$ for $x:S$ and $A:S\to\mathrm{Ab}$, we have that $\check{C}(S,T,\lambda x.A_x^{T_x})$ is exact.
\end{lemma}

\begin{proof}
Assume given a cocycle, i.e. $\beta:\prod_{x:S}A_x^{T_x^3}$ such that for all $x:S$ and $u,v,w,t:T_x$ we have that $\beta_x(u,v,t)+\beta_x(v,w,t) = \beta_x(u,w,t)$. We define $\alpha:\prod_{x:S}A_x^{T_x^2}$ by $\alpha_x(u,t) = \beta_x(t,u,t)$. Then for all $x:S$ and $u,v,t:T_x$ we have that $d_0(\alpha)_x(u,v,t) = \beta_x(t,v,t) - \beta_x(t,u,t) = \beta_x(u,v,t)$ so that $\beta$ is a coboundary.
\end{proof}

\begin{lemma}\label{exact-cech-complex-vanishing-cohomology}
Assume a type $S$ and types $T_x$ for $x:S$ such that $\prod_{x:S}\propTrunc{T_x}$ and $A:S\to\mathrm{Ab}$ such that $\check{C}(S,T,A)$ is exact.
Then given $\alpha:\prod_{x:S}\B A_x$ with $\beta:\prod_{x:S} (\alpha(x) = *)^{T_x}$, we can conclude $\alpha = *$.
\end{lemma}

\begin{proof}
We define $g : \prod_{x:S} A_x^{T_x^2}$ by $g_x(u,v) = \beta_x(u)^{-1}\cdot\beta_x(v)$.
It is a cocycle in the \v{C}ech complex, so that by exactness there is $f:\prod_{x:S}A_x^{T_x}$ such that for all $x:S$ and $u,v:T_x$ we have that $g_x(u,v)=f_x(u)^{-1}\cdot f_x(v)$.
Then we define $\beta' : \prod_{x:S}(\alpha(x)=*)^{T_x}$ by $\beta'_x(u) = \beta_x(u)\cdot f_x(u)^{-1}$
so that for all $x:S$ and $u,v:T_x$ we have that $\beta'_x(u) = \beta'_x(v)$ is equivalent to $f_x(u)^{-1}\cdot f_x(v) = \beta_x(u)^{-1}\cdot\beta_x(v)$, which holds by definition. Therefore $\beta'$ factors through $S$, giving a proof of $\alpha = *$.
\end{proof}


\subsection{Cohomology of Stone spaces}

%
%%\subsection{Needed results}
%
%%\rednote{Should probably be moved elsewhere}
%
\begin{lemma}\label{finite-approximation-surjection-stone}
Assume given $S:\Stone$ and $T:S\to\Stone$ such that $\prod_{x:S}\propTrunc{T(x)}$.
Then there exists a sequence of finite types $(S_k)_{k:\N}$ with limit $S$ 
%\rednote{Should the maps in the sequence be mentioned? (Maps $p_k$ are mentioned below)}
%\begin{equation}
%\begin{tikzcd}
%S_0 & S_1 \ar[l,"p_0"]& S_2\ar[l,"p_1"] & \cdots\ar[l]\\
%\end{tikzcd}
%\end{equation}
%such that: 
%\[\mathrm{lim}_kS_k = S\]
and a compatible sequence of families of finite types $T_k$ over $S_k$
with $\prod_{x:S_k}\propTrunc{T_k(x)}$ and 
$\mathrm{lim}_k\left(\sum_{x:S_k}T_k(x)\right) = \sum_{x:S}T(x)$. 
%
%Given $S:\Stone$ and $T:S\to\Stone$ such that $\prod_{x:S}\propTrunc{T(x)}$, there exists a sequence of finite types $(S_k)_{k:\N}$
%\rednote{Should the maps in the sequence be mentioned? (Maps $p_k$ are mentioned below)}
%%\begin{equation}
%%\begin{tikzcd}
%%S_0 & S_1 \ar[l,"p_0"]& S_2\ar[l,"p_1"] & \cdots\ar[l]\\
%%\end{tikzcd}
%%\end{equation}
%such that: 
%\[\mathrm{lim}_kS_k = S\]
%and for each $k:\N$ we have a family of finite types $T_k(x)$ for $x:S_k$ such that $\prod_{x:S_k}\propTrunc{T_k(x)}$ with maps $T_{k+1}(x) \to T_k(p_k(x))$ such that:
%\[\mathrm{lim}_k\left(\sum_{x:S_k}T_k(x)\right) = \sum_{x:S}T(x)\]
\end{lemma}

\begin{proof}
  This follows from \Cref{ProFiniteMapsFactorization} and \Cref{stone-sigma-closed}.
%\rednote{ \@ Hugo This follows from \Cref{ProFiniteMapsFactorization} and \Cref{stone-sigma-closed} 
%  and considering the surjection $(\Sigma_{x:S} T(x)) \to S$, but we discussed whether it might be easier to 
%  refactor the proof where you use the above or make a remark after \Cref{stone-sigma-closed}}
\end{proof}

\begin{lemma}\label{cech-complex-vanishing-stone}
Assume given $S:\Stone$ with $T:S\to\Stone$ such that $\prod_{x:S}\propTrunc{T_x}$. Then we have that $\check{C}(S,T,\Z)$ is exact.
\end{lemma}


\begin{proof}
We apply \cref{finite-approximation-surjection-stone} to get $S_k$ and $T_k$ finite. Then by \cref{scott-continuity} we have that $\check{C}(S,T,\Z)$ is the sequential colimit of the $\check{C}(S_k,T_k,\Z)$. By \cref{section-exact-cech-complex} we have that each of the $\check{C}(S_k,T_k,\Z)$ is exact, and a sequential colimit of exact sequences is exact.
\end{proof}

\begin{lemma}\label{eilenberg-stone-vanish}
Given $S:\Stone$, we have that $H^1(S,\Z) = 0$. 
\end{lemma}

\begin{proof}
Assume given a map $\alpha:S\to \B\Z$. We use local choice to get $T:S\to\Stone$ such that $\prod_{x:S}\propTrunc{T_x}$ with $\beta:\prod_{x:S}(\alpha(x)=*)^{T_x}$. Then we conclude by \cref{cech-complex-vanishing-stone} and \cref{exact-cech-complex-vanishing-cohomology}.
\end{proof}

\begin{corollary}\label{stone-commute-delooping}
For any $S:\Stone$ the canonical map $\B(\Z^S) \to (\B\Z)^S$ is an equivalence.
\end{corollary}


\subsection{\v{C}ech cohomology of compact Hausdorff spaces}

\begin{definition}
A \v{C}ech cover consists of $X:\CHaus$ and $S:X\to\Stone$ such that $\prod_{x:X}\propTrunc{S_x}$ and $\sum_{x:X}S_x:\Stone$.
\end{definition}

By definition any compact Hausdorff type has a \v{C}ech cover.

\begin{lemma}\label{cech-eilenberg-0-agree}
Given a \v{C}ech cover $(X,S)$, we have that $H^0(X,\Z) = \check{H}^0(X,S,\Z)$.
\end{lemma}

\begin{proof}
By definition an element in $\check{H}^0(X,S,\Z)$ is a map $f:\prod_{x:X}\Z^{S_x}$
such that for all $u,v:S_x$ we have $f(u)=f(v)$. Since $\Z$ is a set and the $S_x$ are merely inhabited, this is equivalent to $\Z^X$.
\end{proof}

\begin{lemma}\label{eilenberg-exact}
Given a \v{C}ech cover $(X,S)$ we have an exact sequence:
\[H^0(X,\lambda x.\Z^{S_x}) \to H^0(X,\lambda x.\Z^{S_x}/\Z) \to H^1(X,\Z)\to 0\]
\end{lemma}

\begin{proof}
We use the long exact cohomology sequence associated to:
\[0 \to \Z \to \Z^{S_x} \to \Z^{S_x}/\Z\to 0\]
We just need $H^1(X,\lambda x.\Z^{S_x}) = 0$ to conclude. But by \cref{stone-commute-delooping} we have that $H^1(X,\lambda x.\Z^{S_x}) = H^1\left(\sum_{x:X}S_x,\Z\right)$ which vanishes by \cref{eilenberg-stone-vanish}.
\end{proof}

\begin{lemma}\label{cech-exact}
Given a \v{C}ech cover $(X,S)$ we have an exact sequence:
\[\check{H}^0(X,\lambda x.\Z^{S_x}) \to \check{H}^0(X,\lambda x.\Z^{S_x}/\Z) \to \check{H}^1(X,\Z)\to 0\]
\end{lemma}

\begin{proof}
By \cref{eilenberg-stone-vanish} and the long exact sequence for cohomology, we have an exact sequence of complexes:
\[0 \to \check{C}(X,S,\Z) \to \check{C}(X,S,\lambda x.\Z^{S_x}) \to \check{C}(X,S,\lambda x.\Z^{S_x}/\Z)\to 0\]
But since $\check{H}^1(X,\lambda x.\Z^{S_x}) = 0$ by \cref{canonical-exact-cech-complex}, we conclude using the associated long exact sequence.
\end{proof}

\begin{theorem}\label{cech-eilenberg-1-agree}
Given a \v{C}ech cover $(X,S)$, we have that $H^1(X,\Z) = \check{H}^1(X,S,\Z)$
\end{theorem}

\begin{proof}
We apply \cref{cech-eilenberg-0-agree}, \cref{eilenberg-exact} and \cref{cech-exact}.
\end{proof}

This means that \v{C}ech cohomology does not depend on $S$.

\subsection{Cohomology of the interval}
%
%Recall that we denote $C_n=2^n$ with a binary relation $\sim_n$ on $C_n$ such that for all $x,y:2^\N$ we have that:
%\[\left(\forall(n:\N).\ x|_n\sim_n y|_n\right) \leftrightarrow x=_\I y\]
%
%\begin{lemma}\label{description-Cn-simn}
%We have that $(C_n,\sim_n)$ is equivalent to $(\mathrm{Fin}(2^n),\lambda x,y.\ |x-y|\leq 1)$.
%\end{lemma}
\begin{remark}\label{description-Cn-simn}
  Recall from \Cref{def-cs-Interval} that 
  there is a binary relation $\sim_n$ on $2^n=:\I_n$ such that 
  $(2^n,\sim_n)$ is equivalent to  $(\mathrm{Fin}(2^n),\lambda x,y.\ |x-y|\leq 1)$
  and for $\alpha,\beta:2^\N$ we have $(cs(\alpha) = cs(\beta)) \leftrightarrow 
  \left(\forall_{n:\N}\alpha|_n \sim_n \beta|_n\right)$. 
\end{remark}

We define $\I_n^{\sim2} = \Sigma_{x,y:\I_n}x\sim_n y$ and $\I_n^{\sim3} = \Sigma_{x,y,z:\I_n}x\sim_n y \land y\sim_n z\land x\sim_n z$.

\begin{lemma}\label{Cn-exact-sequence}
For any $n:\N$ we have an exact sequence:
\[0\to \Z\to \Z^{\I_n} \to \Z^{\I_n^{\sim2}} \to \Z^{\I_n^{\sim3}}\]
with the obvious boundary maps.
\end{lemma}

\begin{proof}
It is clear that the map $\Z\to \Z^{\I_n}$ is injective as $\I_n$ is inhabited, so the sequence is exact at $\Z$. Assume a cocycle $\alpha:\Z^{\I_n}$, meaning that for all $u,v:\I_n$, if $u\sim_nv$ then $\alpha(u)=\alpha(v)$. Then by \cref{description-Cn-simn} we see that $\alpha$ is constant, so the sequence is exact at $\Z^{\I_n}$.

Assume a cocycle $\beta:\Z^{\I_n^{\sim2}}$, meaning that for all $u,v,w:\I_n$ such that $u\sim_nv$, $v\sim_nw$ and $u\sim_nw$ we have that $\beta(u,v)+\beta(v,w) = \beta(u,w)$. %This is equivalent to asking $\beta(u,u)=0$ and $\beta(u,v) = -\beta(v,u)$.
Using \cref{description-Cn-simn} we can define $\alpha(n) = \beta(0,1)+\cdots+\beta(n-1,n)$.
We can check that $\beta(m,n) = \alpha(n)-\alpha(m)$, so $\beta$ is indeed a coboundary and the sequence is exact at $\Z^{\I_n^{\sim2}}$.
\end{proof}

\begin{proposition}\label{cohomology-I}
We have that $H^0(\I,\Z) = \Z$ and $H^1(\I,\Z) = 0$.
\end{proposition}

\begin{proof}
Consider $cs:2^\N\to\I$ and the associated \v{C}ech cover $T$ of $\I$ defined by: 
\[T_x = \Sigma_{y:2^\N} (x=_\I cs(y))\]
Then for $l=2,3$ we have that $\mathrm{lim}_n\I_n^{\sim l} = \sum_{x:\I} T_x^l$. By \cref{Cn-exact-sequence} and stability of exactness under sequential colimit, we have an exact sequence:
\[ 0\to \Z\to \mathrm{colim}_n \Z^{\I_n} \to \mathrm{colim}_n \Z^{\I_n^{\sim2}}\to \mathrm{colim}_n \Z^{\I_n^{\sim3}}\]
By \cref{scott-continuity} this sequence is equivalent to:
\[ 0\to \Z\to \Pi_{x:\I}\Z^{T_x} \to  \Pi_{x:\mathbb{I}}\Z^{T_x^2} \to  \Pi_{x:\mathbb{I}}\Z^{T_x^3}\]
So it being exact implies that $\check{H}^0(\I,T,\Z) = \Z$ and $\check{H}^1(\I,T,\Z) = 0$.
We conclude by \cref{cech-eilenberg-0-agree} and \cref{cech-eilenberg-1-agree}.
\end{proof}

\begin{remark}
We could carry a similar computation for $\mathbb{S}^1$, by approximating it with $2^n$ with $0^n\sim_n1^n$ added. We would find $H^1(\mathbb{S}^1,\Z)=\Z$.
\end{remark}


\subsection{Brouwer's fixed-point theorem}

Here we consider the modality defined by localising at $\I$ \cite{modalities}, denoted by $L_\I$. We say that $X$ is $\I$-local if $L_\I(X) = X$ and that it is $\I$-contractible if $L_\I(X)=1$.

\begin{lemma}\label{Z-I-local}
$\Z$ and $2$ are $\I$-local.
\end{lemma}

\begin{proof}
By \cref{cohomology-I}, from $H^0(\I,\Z)=\Z$ we get that the map $\Z\to \Z^\I$ is an equivalence, so $\Z$ is $\I$-local. We see that $2$ is $\I$-local as it is a retract of $\Z$.
\end{proof}

\begin{remark}
Since $2$ is $\I$-local, we know by duality that any Stone space is $\I$-local.
\end{remark}

\begin{lemma}\label{BZ-I-local}
$\B\Z$ is $\I$-local.
\end{lemma}

\begin{proof}
Any identity type in $\B\Z$ is a $\Z$-torsor, so it is $\I$-local by \cref{Z-I-local}. So there is at most one factorisation of any map $\I\to \B\Z$ through $1$. From $H^1(\I,\Z)=0$ we get that there merely exists such a factorisation.
\end{proof}

\begin{lemma}\label{continuously-path-connected-contractible}
Assume $X$ a type with $x:X$ such that for all $y:X$ we have $f:\I\to X$ such that $f(0)=x$ and $f(1)=y$. Then $X$ is $\I$-contractible.
\end{lemma}

\begin{proof}
%First we prove that the map:
%\[\eta_X:X\to L_\I(X)\] 
%is surjective. Indeed its fiber are $\I$-contractible, but for any type $F$ we have a map:
%\[L_\I(F) \to L_\mathbb{F}(\propTrunc{F}) = \propTrunc{F}\] 
For all $y:X$ we get a map $g:\I\to X\to L_\I(X)$ such that $g(0) = [x]$ and $g(1)=[y]$. Since $L_\I(X)$ is $\I$-local this means that $\prod_{x:X}[*]=[x]$. We conclude $\prod_{y:L_\I(X)}[x]=y$ by applying the elimination principle for the modality.
\end{proof}

\begin{corollary}\label{R-I-contractible}
We have that $\R$ and $\mathbb{D}^2=\{x,y:\mathbb R\ \vert\ x^2+y^2\leq 1\}$ are $\I$-contractible.
\end{corollary}

\begin{proposition}\label{shape-S1-is-BZ}
$L_\I(\R/\Z) = \B\Z$.
\end{proposition}

\begin{proof}
As for any group quotient, the fibers of the map $\R\to\R/\Z$ are $\Z$-torsors, se we have an induced pullback square:
\[
\begin{tikzcd}
\R\ar[r]\ar[d] & 1\ar[d] \\
\R/\Z\ar[r] & \B\Z
\end{tikzcd}
\]
Now we check that the bottom map is an $\I$-localisation. Since $\B\Z$ is $\I$-local by \cref{BZ-I-local}, it is enough to check that its fibers are $\I$-contractible. Since $\B\Z$ is connected it is enough to check that $\R$ is $\I$-contractible, but this is \cref{R-I-contractible}.
\end{proof}

\begin{remark}
By \cref{BZ-I-local}, for any $X$ we have that $H^1(X,\Z) = H^1(L_{\I}(X),\Z)$, so that by \cref{shape-S1-is-BZ} we have that $H^1(\R/\Z,\Z) = H^1(\B\Z,\Z) = \Z$.
\end{remark}

We omit the proof that $\mathbb{S}^1=\{x,y:\R\ \vert\ x^2+y^2=1\}$ is equivalent to $\R/\Z$.
The equivalence can be constructed using trigonometric functions, which exists by Proposition 4.12 in \cite{Bishop}.

\begin{proposition}
\label{no-retraction}
The map $\mathbb{S}^1\to \mathbb{D}^2$ has no retraction.
\end{proposition}

\begin{proof}
By \cref{R-I-contractible} and \cref{shape-S1-is-BZ} we would get a retraction of $\B\Z\to 1$, so $\B\Z$ would be contractible.
\end{proof}

\begin{theorem}[Intermediate value theorem]
  \label{ivt}
  For any $f: \I\to \I$ and $y:\I$ such that $f(0)\leq y$ and $y\leq f(1)$,
  there exists $x:\I$ such that $f(x)=y$.
\end{theorem}

\begin{proof}
  By \Cref{InhabitedClosedSubSpaceClosedCHaus}, the proposition $\exists x:\I.f(x)=y$ is closed and therefore $\neg\neg$-stable, so we can proceed with a proof by contradiction.
  If there is no such $x:\I$, we have $f(x)\neq y$ for all $x:\I$.
  By \cref{LesserOpenPropAndApartness} we have that for different numbers $a,b:\I$, we have $a<b$ or $b<a$, so the following two sets cover $\I$:
  \[
    U_0:= \{x:\I\mid f(x)<y\} \quad\quad
    U_1:= \{x:\I\mid y<f(x)\}
    \]
  Since $U_0$ and $U_1$ are disjoint, we have $\I=U_0+U_1$ which allows us to define a non-constant function $\I\to 2$, which contradicts \Cref{Z-I-local}.
\end{proof}

\begin{theorem}[Brouwer's fixed-point theorem]
  For all $f:\mathbb{D}^2\to \mathbb{D}^2$ there exists $x:\mathbb{D}^2$ such that $f(x)=x$.
\end{theorem}

\begin{proof}
  As above, by \Cref{InhabitedClosedSubSpaceClosedCHaus}, we can proceed with a proof by contradiction,
  so we assume $f(x)\neq x$ for all $x:\mathbb{D}^2$.
  For any $x:\mathbb{D}^2$ we set $d_x= x-f(x)$, so we have that one of the coordinates of $d_x$ is invertible.
  Let $H_x(t) = f(x) + t\cdot d_x $ be the line through $x$ and $f(x)$.
  The intersections of $H_x$ and $\partial\mathbb{D}^2=\mathbb{S}^1$ are given by the solutions of an equation quadratic in $t$. By invertibility of one of the coordinates of $d_x$, there is exactly one solution with $t> 0$.
  We denote this intersection by $r(x)$ and the resulting map $r:\mathbb D^2\to\mathbb S^1$ has the property that it preserves $\mathbb{S}^1$.
  Then $r$ is a retraction from $\mathbb{D}^2$ onto its boundary $\mathbb{S}^1$, which is a contradiction by \Cref{no-retraction}.
\end{proof}
