\subsection{Stone spaces are stable under dependent sums}
We will show that Stone spaces are precisely totally disconnected compact Hausdorff spaces. 
We will use this to prove that a dependent sum of Stone spaces is Stone.

\begin{lemma}\label{AlgebraCompactHausdorffCountablyPresented}
Assume $X$ compact Hausdorff, then $2^X$ is countably presented.
\end{lemma}

\begin{proof}
  Consider some quotient map $q:S\twoheadrightarrow X$ with $S:\Stone$. 
%First we choose $S\to X$ surjective with $S$ Stone and prove that $2^X$ is an open subalgebra of $2^S$.
%
  This induces an injection of Boolean algebras $2^X \hookrightarrow 2^S$.
  Note that $a:S\to 2$ lies in $2^X$ iff for all $s,t:S$, 
  $(q(s) =_X q(t)) \to (a(s) =_2a(t))$. 
  As equality in $X$ is closed and equality in $2$ is decidable, \Cref{ImplicationOpenClosed}
  tells us that this implication is closed. 
  By \Cref{AllOpenSubspaceOpen}, we conclude that 
  $\forall_{s:S} \forall_{t:S} ((q(s) =_X q(t)) \to (a(s) =_2 a(t)))$ is open. 
  Hence $2^X$ is an open subalgebra of $2^S$, 
  hence countably presented by 
  \Cref{PropOpenIffOdisc}, \Cref{OdiscSigma} and \Cref{ODiscBAareBoole}.
%
%
%  \rednote{It might be nice to show that Boolean algebras are countably presented iff they are overtly discrete}
%Now we prove that open subalgebras of countably presented agebras are countably presented. Assume $U\subset 2[\N] / F$ such a subalgebra. We have that $U$ is equivalent to the algebra generated by the $s:2[\N]$ such that $[s]\in U$ quotiented by the relation $s=t$ for all $s,t:2[\N]$ such that $[s],[t]\in U$ and $[s]=[t]$.
%
%Using that $2[\N]$ is countable and that $[s]=[t]$ is open by \Cref{BooleEqualityOpen}, we see that $U$ is generated by variables and relations each indexed by an open in $\N$. But by \Cref{OpenInNAreDecidableInN} any open in $\N$ is countable, so $U$ is countably presented.
\end{proof}
\begin{definition}
  Let $X:\Chaus$ and $x:X$. 
  We define the connected component of $x$ (denoted $Q_x$)
  as the intersection of all decidable subsets of $X$ containing $x$. 
\end{definition}

\begin{lemma}\label{ConnectedComponentClosedInCompactHausdorff}
For all $X:\CHaus$ with $x:X$, $Q_x$ is a countable intersection of decidables in $X$.
\end{lemma}
\begin{proof}
%  By \Cref{AlgebraCompactHausdorffCountablyPresented} we have that $2^X$ is countably presented, 
%  therefore we can enumerate the elements of $2^X$, say as $(D_n)_{n:\N}$. 
  By \Cref{AlgebraCompactHausdorffCountablyPresented},
  we can enumerate the elements of $2^X$, say as $(D_n)_{n:\N}$. 
  if we define $E_n$ for $n:\N$ as $D_n$ if $x\in D_n$ and $X$ otherwise, we have that:
  $\cap_{n:\N}E_n = Q_x$.
\end{proof}
%

\begin{lemma}\label{ConnectedComponentSubOpenHasDecidableInbetween}
  Let $X:\Chaus, x:X$ and suppose $U\subseteq X$ is open with $Q_x\subseteq U$. 
  Then we have some decidable $E\subseteq X$ with $E(x)$ and $E\subseteq U$. 
\end{lemma}
\begin{proof}
  By \Cref{ConnectedComponentClosedInCompactHausdorff}, 
  we have $Q_x = \bigcap_{n:\N}D_n$ with $D_n\subseteq X$ decidable. 
  If $Q_x \subseteq U$, we have that 
  $$Q_x\cap \neg U = \bigcap_{n:\N} (D_n \cap \neg U) = \emptyset.$$
  By \Cref{CHausFiniteIntersectionProperty} there is some $N:\N$ with 
  $$(\bigcap_{n\leq N} D_n )\cap \neg U  = \bigcap_{n\leq N} (D_n \cap \neg U) = \emptyset.$$
  Therefore $\bigcap_{n\leq N} D_n \subseteq \neg\neg U$, which equals $U$ by \Cref{rmkOpenClosedNegation}.
  Note that decidable subsets are closed under finite intersection. 
  Finally as $x\in D_n$ for all $n:\N$, $x\in \bigcap_{n\leq N} D_n$ as well and we're done. 
\end{proof}

\begin{lemma}\label{ConnectedComponentConnected}
Let $X$ be Compact Hausdorff with $x:X$. Then $Q_x$ is connected.
\end{lemma}
\begin{proof}
Assume given a separation $Q_x = A\cup B$ with $A,B$ disjoint and decidable in $Q_x$, and let us assume that $x\in A$. 
We want to prove that $B=\emptyset$. 
%
Since $Q_x$ is closed in $X$ by \Cref{ConnectedComponentClosedInCompactHausdorff}, 
we have that $A$ and $B$ are closed disjoint in $X$, 
so that by \Cref{CHausSeperationOfClosedByOpens} we have $U,V$ disjoint open such that $A\subset U$ and $B\subset V$. 
%
By \Cref{ConnectedComponentSubOpenHasDecidableInbetween} we have a decidable $D$ such that $Q_x\subset D\subset U\cup V$. 
Then we define $E = D\cap U$. 
We have that $E$ is open, it is closed as $E=D\cap \neg V$, therefore it is decidable by \Cref{ClopenDecidable}.
%
Then $Q_x\subset E$ with $E$ decidable and $B\cap E = \emptyset$. 
But then $Q_x\cap B = \emptyset$ and $B=\emptyset$.
\end{proof}

\begin{lemma}\label{StoneCompactHausdorffTotallyDisconnected}
Let $X:\CHaus$, then $X$ is Stone iff $\forall_{x:X}Q_x=\{x\}$.
\end{lemma}

\begin{proof}
  By \Cref{AxStoneDuality}, it is clear that for all $x:S$ with $S$ Stone we have that $Q_x=\{x\}$.
%
For the converse, we show that the map:
\[X\to Sp(2^X)\]
is an equivalence and conclude by \Cref{AlgebraCompactHausdorffCountablyPresented}. 

Surjectivity always hold, indeed considering $q:S\to X$ surjective with $S$ Stone, we have that $2^X\subset 2^S$ as so that the by \Cref{FormalSurjectionsAreSurjections} the map:
$$S = Sp(2^S)\to Sp(2^X)$$
is surjective and it factors though $X$.

Now let us prove injectivity. Assume $x,y:X$ having the same image in $Sp(2^X)$. This means that any map in $X\to 2$ has the same value on $x$ and $y$, so $x\in Q_y$ and by hypothesis $x=y$.
\end{proof}

\begin{theorem}
  \label{stone-sigma-closed}
Assume given $S:\Stone$ with $T:S\to\Stone$. Then $\Sigma_{x:S}T(x)$ is Stone.
\end{theorem}

\begin{proof}
By \Cref{SigmaStoneCompactHausdorff} we have that $\Sigma_{x:S}T(x)$ is compact Hausdorff. By \Cref{StoneCompactHausdorffTotallyDisconnected} it is enough to show that for all $x:S$ and $y:T(x)$ we have that $Q_{(x,y)}$ is a singleton.

Assume $(x',y')\in Q_{(x,y)}$, then for any map $q:S\to 2$ we have that:
$$ q(x) = q\circ \pi_1(x,y) = q\circ \pi_1(x',y') = q(x')$$
so that $x'\in Q_x$ and since $S$ is Stone by \Cref{StoneCompactHausdorffTotallyDisconnected} we have that $x=x'$.

Therefore we have $Q_{(x,y)}\subset \{x\}\times T_x$ so that by \Cref{ConnectedComponentConnected} we have an inhabited  connected subtype of a Stone space. Then any map $T_x\to 2$ is constant on $Q_{(x,y)}$ and by \Cref{StoneCompactHausdorffTotallyDisconnected} we conclude that it is a singleton.
\end{proof}


