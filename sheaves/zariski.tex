In this section we work in with Zariski sheaves, i.e. the usual synthetic algebraic geometry. A lot of it is direct reformulation of the previous section.

\subsection{Definition of sheaves}

\begin{definition}
A pre-topology $T$ is a class of affine schemes.
\end{definition}

\begin{definition}
A topology $T$ is a class of affine schemes such that:
\begin{itemize}
\item It is stable by dependent sums and contains the unit.
\item It is stable by Zariski principal cover, meaning that given a Zariski principal cover:
\[\sum_{i:I}U_i \to X\]
if $X\in T$ then $\sum_{i:I}U_i\in T$.
\end{itemize}
\end{definition}

There is a smallest topology generated by a pre-topology. 

\begin{definition}
Let $T$ be a pre-topology, then a type is a $T$-sheaf if it is $\propTrunc{X}$-local for all $X\in T$. 
\end{definition}

This agree with the usual definition of sheaves at least for sets (and presumably for all $n$-types for a finite $n$). We write $L_T$ for $T$-sheafification, which is a lex modality. 

\begin{lemma}\label{sheaf-generated-topology}
Let $T$ be a topology and let $T'$ be the smallest topology containing $T$. A type is a $T$-sheaf if and only if it is a $T'$-sheaf.
\end{lemma}

\begin{proof}
We proceed as in \cref{topology-pretopology-same-sheaves}. The only new result we need is that is that the class of affine schemes $X$ such that $L_T\propTrunc{X}$ is closed by Zariski cover. But if:
\[Y\to X\]
is a Zariski cover then:
\[\propTrunc{Y}\leftrightarrow\propTrunc{X}\]
so we can conclude.
\end{proof}


\subsection{Covers and choice}

\begin{lemma}\label{sheaf-proposition}
Let $T$ be a topology and $P$ be a proposition, then:
\[L_T(P)\leftrightarrow \exists X\in T.\ P^X\]
\end{lemma}

\begin{proof}
We proceed as in \cref{sheaf-replacement-proposition}, using Zariski-local choice and the stability of $T$ by Zariski cover instead of choice.
\end{proof}

\begin{definition}
Let $T$ be a pre-topology. A $T$-cover of an affine scheme is inductively defined by:
\begin{itemize}
\item The identity is a $T$-cover, and the composite of $T$-covers is a $T$-cover.
\item A map:
\[f:X\to Y\] 
is a $T$-cover if we have a Zariski cover $(U_i)_{i:I}$ of $Y$ where the maps:
\[f:f^{-1}(U_i) \to U_i\]
are $T$-cover.
\item A map which fibers are in $T$ is a $T$-cover.
\end{itemize}
\end{definition}

\begin{lemma}\label{zariski-cover-are-cover}
For any pre-topology $T$, Zariski covers are $T$-cover.
\end{lemma}

\begin{proof}
Zariski covers are Zariski-locally identity maps.
\end{proof}

\begin{lemma}\label{cover-can-be-defined-pointwise}
Let $T$ be a pre-topology generating the topology $T'$. Then a map is a $T$-cover if and only if its fibers are in $T'$.
\end{lemma}

\begin{proof}
First we prove inductively that $T$-covers have fibers in $T'$. 
\begin{itemize}
\item If the $T$-cover is the identity, we can conclude as $1\in T'$. If it is a composite we conclude using the stability of $T'$ under dependent sums.
\item Assume a map:
\[f:X\to Y\] 
with a Zariski cover $(U_i)_{i:I}$ of $Y$ where the induced maps:
\[f_i:f^{-1}(U_i) \to U_i\]
have fibers in $T'$. Then any $y:Y$ is in $U_i$ for some $i$ so the fiber of $f$ over $y$ is equivalent to the fiber of $f_i$, which is in $T'$.
\item If the fibers of the $T$-cover are in $T$, then we can conclude as $T\subset T'$.
\end{itemize}
Now let us prove the converse. Assume given a map between affine schemes with fibers in $T'$. Zariski-locally we can assume we are in one of the following case:
\begin{itemize}
\item The fibers are $1$. We can conclude because identity maps are $T$-covers.
\item The fibers are dependent sum of things in $T'$. Here we conclude inductively from the fact that  $T$-covers are stable under composition.
\item The fibers are Zariski coverings of things in $T'$. Then the map is a composite of a Zariski cover followed by a $T$-cover. We conclude by \cref{zariski-cover-are-cover} and the stability of $T$-cover by composition. 
\item The fibers are in $T$. Then we conclude by definition.
\end{itemize}
\end{proof}

\begin{lemma}\label{cover-local-choice}
Let $T$ be a pre-topology, assume given an affine scheme $\Spec(A)$ and a family of types $P(x)$ for $x:A$. Assume:
\[\prod_{x:\Spec(A)}L_T\propTrunc{P(x)}\]
then there exists a $T$-cover:
\[f:\Spec(B)\to \Spec(A)\]
such that:
\[\prod_{y:\Spec(B)} P(f(y))\]
\end{lemma}

\begin{proof}
Same as \cref{sheaves-have-local-choice} considering $T'$ the topology generated by $T$, with \cref{cover-can-be-defined-pointwise} and Zariski-local choice rather than choice.
\end{proof}


\subsection{Sheaf models TODO}

This section is incomplete, we would need to study the sheaf interpretation more in details (TODO).

\begin{lemma}\label{cover-are-surjective}
Let $T$ be a pre-topology, then we have $L_T(\propTrunc{X})$ for all $X\in T$.
\end{lemma}

\begin{proof}
Immediate by \cref{sheaf-proposition}.
\end{proof}

\begin{theorem}\label{sheaves-internal}
Let $T$ be a subcanonical pre-topology, then $T$-sheaves enjoys the following:
\begin{enumerate}[(i)]
\item For any $X\in T$ we have $\propTrunc{X}$.
\item Synthetic quasi-coherence.
\item Affine schemes have $T$-local choice (meaning choice using $T$-covers).
\end{enumerate}
\end{theorem}

\begin{proof}
TODO
\end{proof}


\subsection{Topology generated by a pretopology}

\begin{definition}
The Zariski pre-topology consists of affine schemes $X$ merely of the form:
\[u_1\not=0+\cdots+u_n\not=0\] 
with $u_1,\cdots,u_n:R$ such that $\propTrunc{X}$.
\end{definition}

\begin{lemma}
A class $T$ of affine schemes is a topology if and only if:
\begin{itemize}
\item It is stable by dependent sums and contains the unit.
\item The Zariski pre-topology is included in $T$.
\end{itemize}
\end{lemma}

\begin{proof}
If the Zariski pre-topology is included in $T$ and $T$ stable under dependent sums, then $T$ stable by Zariski cover. Conversely any $X$ in the Zariski topology is a Zariski cover of $1$, so it belongs to any topology.
\end{proof}

Beware: the Zariski pre-topology might not be a topology... I don't think it's closed by dependent sums...

\begin{definition}
Let $T$ be a pre-topology, we define $T_\Sigma$ inductively:
\begin{itemize}
\item $1\in T_\Sigma$
\item If $X\in Zar$ and $Y:X\to T_\Sigma$ then $\Sigma_XY\in T_\Sigma$.
\item If $X\in T$ and $Y:X\to T_\Sigma$ then $\Sigma_XY\in T_\Sigma$.
\end{itemize}
\end{definition}

\begin{remark}
If $1\in T$, we can merge the second and third constructor as in:
\begin{itemize}
\item $1\in T_\Sigma$
 \item If $X\in T$, $Y:X\to Zar$ and $Z:\Sigma_XY\to T_\Sigma$, then $\Sigma_X\Sigma_YZ\in T_\Sigma$.
\end{itemize}
\end{remark}

\begin{lemma}\label{description-topology}
Let $T$ be a pre-topology, then $T_\Sigma$ is the topology generated by $T$.
\end{lemma}

\begin{proof}
It is clear that any topology containing $T$ contains $T_\Sigma$. Then we just need to prove $T_\Sigma$ is a topology. It is clear that $Zar\subseteq T_\Sigma$. Now we check $T_\Sigma$ stable under $\Sigma$. Assume $X\in T_\Sigma$ and $Y:X\to T_\Sigma$.
\begin{itemize}
\item If $X=1$ it is clear.
\item If $X=\Sigma_{X'}Y'$ with $X'\in Zar$ and $Y':X\to T_\Sigma$, then by induction $\Sigma_{Y'}Y\in T_\Sigma$ so we can conclude.
\item Same with $X'\in T$.
\end{itemize}
\end{proof}

\begin{lemma}\label{Tsigma-proposition}
Let $T$ be a pre-topology and $P$ be a proposition, then:
\[L_T(P) = \exists_{X:T_\Sigma}. (X\to P)\]
\end{lemma}

\begin{proof}
First we check that $\exists_{X:T_\Sigma}. (X\to P)$ is a $T$-sheaf. Given $X$ in $T$ such that $X\to \exists_{Z:T_\Sigma}. (Z\to P)$, by local choice we get $Y:X\to Zar$ such that:
\[\Sigma_XY\to \Sigma_{Z:T_\Sigma}.(Z\to P)\]
so that we have that $\Sigma_X\Sigma_YZ\to P$ and therefore $\exists_{Z:T_\Sigma}.(Z\to P)$.

So since $P\to \exists_{X:T_\Sigma}. (X\to P)$, we have that $L_T(P)\to \exists_{X:T_\Sigma}. (X\to P)$.

Now we need to check that given $X:T_\Sigma$ such that $X\to P$, we have $L_T(P)$, which we do inductively on $X\in T_\Sigma$.
\begin{itemize}
\item If $X=1$ this is clear.
\item If $X=\Sigma_{X'}Y'$ with $X\in Zar$ and $Y':X\to T_\Sigma$, by induction we know that for all $x:X$ we have that $(Y'_x\to P)\to L_T(P)$, so that $X\to L_T(P)$ and we conclude since $\propTrunc{X}$.
\item If $X=\Sigma_{X'}Y'$ with $X\in T$ and $Y':X\to T_\Sigma$, by induction we know that for all $x:X$ we have that $(Y'_x\to P)\to L_T(P)$, so that $X\to L_T(P)$ and we conclude since $X\in T$.
\end{itemize}
\end{proof}

\begin{lemma}\label{localisation-stable-join}
Assume given $X$ a type with a maps $A\to B$ and $A'\to B'$ such that the induced maps:
\[X^B\to X^A\]
\[X^{B'}\to X^{A'}\]
are equivalences. Then the induced map:
\[X^{B*B'}\to X^{A*A'}\]
is an equivalence.
\end{lemma}

\begin{proof}
The induced map is equal to the canonical map:
\[X^B\times_{X^{B\times B'}}X^{B'}\to X^A\times_{X^{A\times A'}}X^{A'}\]
so we just need to check that the induced map:
\[X^{B\times B'}\to X^{A\times A'}\]
is an equivalence to conclude, which is clear.
\end{proof}

\begin{lemma}\label{localisation-stable-trucnation}
Assume given $X$ a type with a map $A\to B$ such that the induced map:
\[X^B\to X^A\]
is an equivalence. Then the induced map:
\[X^{\propTrunc{B}}\to X^{\propTrunc{A}}\]
is an equivalence.
\end{lemma}

\begin{proof}
We use that the propositional truncation of a type is the sequential colimit of iterated joins, and then apply \Cref{localisation-stable-join} to conclude.
\end{proof}

\begin{lemma}\label{Tsigma-sheaf-generated}
Let $T$ be a pre-topology, then a type is a $T$-sheaf if and only if it is a $T_\Sigma$-sheaf.
\end{lemma}

\begin{proof}
Since $T\subseteq T_\Sigma$ it is clear that $T_\Sigma$-sheaves are $T$-sheaves. Conversely assume $S$ a $T$-sheaf, assume $X\in T_\Sigma$ and let us prove that $S$ is $\propTrunc{X}$-local by induction on $X\in T_\Sigma$.
\begin{itemize}
\item If $X=1$ it is clear.
\item If $X=\Sigma_{X'}Y'$ with $X'\in T$ and $Y':X\to T_\Sigma$, by induction we know that for all $x:X$ we have that the induced map $S\to S^{\propTrunc{Y_x}}$ is an equivalence, so that the induced map:
\[S^{X'}\to S^{\Sigma_{x:X'}\propTrunc{Y_x}}\] 
is an equivalence, from which by \Cref{localisation-stable-trucnation} we conclude the induced map:
\[S^{\propTrunc{X'}}\to S^{\exists_{x:X'}Y_x}\]
is an equivalence. Since $S$ is assumed $\propTrunc{X'}$-local, we can conclude it is $\exists_{x:X'}Y_x$-local. %the induced map $S\to S^{\propTrunc{X'}}$ is assumed to be an equivalence, we can conclude the induced map:
%\[S \to S^{\exists_{x:X'}Y_x}\]
%is an equivalence.
\item Same when $X'\in Zar$, in this case we even have $\propTrunc{X'}=1$.
\end{itemize}
\end{proof}

\begin{remark}
\Cref{Tsigma-proposition} (resp. \Cref{Tsigma-sheaf-generated}) could be proved by invoking \Cref{description-topology} and \Cref{sheaf-proposition} (resp. \Cref{sheaf-generated-topology}). We nevertheless redid the proof because the original were vague and sketchy.
\end{remark}


\subsection{Topology from pre-topology in Zariski, alternative}

Now we define an alternative $T'_\Sigma$ to $T_\Sigma$. \rednote{Maybe $T_\Sigma$ is obsolete?}

\begin{definition}
Let $T$ be a pre-topology, we define $T'_\Sigma$ inductively:
\begin{itemize}
\item $1\in T'_\Sigma$
\item If $X\in T'_\Sigma$ and $Y:X\to Zar$ then $\Sigma_XY\in T'_\Sigma$.
\item If $X\in T'_\Sigma$ and $Y:X\to T$ then $\Sigma_XY\in T'_\Sigma$.
\end{itemize}
\end{definition}

\begin{lemma}
The class $T_\Sigma'$ is closed under $\Sigma$-type.
\end{lemma}

\begin{proof}
We generalise the property to: 

For all $X\in T_\Sigma'$ and tower of extension $Y_1,\cdots,Y_n$ with $Y_0:X\to T$ or $Y_0:X\to Zar$, then $Y_1:\Sigma_{X}Y_0\to T$ or $Y_1:\Sigma_{X}Y_0\to Zar$, for all $Z:\Sigma_X\Sigma_{Y_0}\cdots\Sigma_{Y_{n-1}}Y_n \to T_\Sigma'$ we have that:
\[\Sigma_X\Sigma_{Y_0}\cdots\Sigma_{Y_{n}}Z \in T_\Sigma'\]
Then the proof is an immediate induction.
\end{proof}

Exactly as with $T_\Sigma$, we can prove the following:

\begin{lemma}\label{TSigma'-topology}
Let $T$ be a pre-topology, then $T_\Sigma'$ is the topology generated by $T$.
\end{lemma}

\begin{lemma}\label{Tsigma'-proposition}
Let $T$ be a pre-topology and $P$ be a proposition, then:
\[L_T(P) = \exists_{X:T_\Sigma'}. (X\to P)\]
\end{lemma}

\begin{lemma}\label{Tsigma'-sheaf-generated}
Let $T$ be a pre-topology, then a type is a $T$-sheaf if and only if it is a $T_\Sigma$-sheaf.
\end{lemma}

We will refine the condition on sheafification of proposition.

\begin{definition}
Define inductively the class $S_\Sigma$ of f.p. algebras as follows:
\begin{itemize}
\item $R\in S_\Sigma$.
\item If $A\in S_\Sigma$ and $P:A[X]$ monic, then $A[X]/P\in S_\Sigma$.
\item If $A\in S_\Sigma$ and $u_1,\cdots,u_n:A$ such that $(u_1,\cdots,u_n)=1$, then $A_{u_1}\times\cdots\times A_{u_n}\in S_\Sigma$.
\end{itemize} 
\end{definition}

\begin{lemma}
If $L_T(\propTrunc{X})$, then there merely exists $A\in S_\Sigma$ such that $\Spec(A)\to X$.
\end{lemma}

\begin{proof}
By local choice it is clear it is enough to prove there exists an $A\in S_\Sigma$ such that $\Spec(A)\to \propTrunc{X}$, so we might as well assume $X$ is a proposition. TODO \rednote{seems wrong actually...}
\end{proof}





